<ui:FluentWindow x:Class="AsaHookCreator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:vm="clr-namespace:AsaHookCreator.ViewModels"
        xmlns:models="clr-namespace:AsaHookCreator.Models"
        mc:Ignorable="d"
        Title="ASA Hook Creator"
        Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        
        <!-- Orange Accent Color -->
        <SolidColorBrush x:Key="AccentBrush" Color="#FF8C00" />
        <SolidColorBrush x:Key="AccentLightBrush" Color="#FFA500" />
        <SolidColorBrush x:Key="AccentDarkBrush" Color="#E07000" />
        
        <!-- Dark Card Style -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1E1E1E" />
            <Setter Property="BorderBrush" Value="#333333" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="20" />
        </Style>
        
        <!-- List Item Style -->
        <Style x:Key="ListItemStyle" TargetType="Border">
            <Setter Property="Background" Value="#252526" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="14,12" />
            <Setter Property="Margin" Value="0,4" />
        </Style>
        
        <!-- Dark ListBox Style -->
        <Style x:Key="DarkListBoxStyle" TargetType="ListBox">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="VirtualizingPanel.IsVirtualizing" Value="True" />
            <Setter Property="VirtualizingPanel.VirtualizationMode" Value="Recycling" />
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
            <Setter Property="ScrollViewer.CanContentScroll" Value="True" />
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Dark TabControl Style -->
        <Style x:Key="DarkTabControlStyle" TargetType="TabControl">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>
        
        <!-- Dark TabItem Style with Orange accent -->
        <Style x:Key="DarkTabItemStyle" TargetType="TabItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="#888888" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" 
                                Background="Transparent" 
                                BorderThickness="0,0,0,2" 
                                BorderBrush="Transparent"
                                Padding="{TemplateBinding Padding}"
                                Margin="0,0,4,0">
                            <ContentPresenter x:Name="ContentSite"
                                              ContentSource="Header"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#FF8C00" />
                                <Setter Property="Foreground" Value="White" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#2D2D2D" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Background="#0D0D0D">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="ASA Hook Creator" 
                     ShowMaximize="True" 
                     ShowMinimize="True"
                     Background="#151515" />

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24,12,24,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="340" MinWidth="280" />
                <ColumnDefinition Width="20" />
                <ColumnDefinition Width="*" MinWidth="500" />
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Header Sources -->
            <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header with Orange gradient -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                        <Border CornerRadius="10" Padding="10" Margin="0,0,14,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#FF8C00" Offset="0"/>
                                    <GradientStop Color="#FFA500" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ui:SymbolIcon Symbol="Folder24" FontSize="22" Foreground="White" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Header Sources" 
                                       FontSize="20" 
                                       FontWeight="SemiBold"
                                       Foreground="White" />
                            <TextBlock Text="{Binding CurrentFolderPath, TargetNullValue='No folder selected'}" 
                                       FontSize="11"
                                       Foreground="#707070"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="180" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Action Buttons with Orange primary -->
                    <Grid Grid.Row="1" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <ui:Button Grid.Column="0"
                                   Content="Folder"
                                   Icon="{ui:SymbolIcon FolderOpen24}"
                                   Command="{Binding LoadHeaderFolderCommand}"
                                   Appearance="Primary"
                                   HorizontalAlignment="Stretch" />
                        
                        <ui:Button Grid.Column="2"
                                   Content="File"
                                   Icon="{ui:SymbolIcon Document24}"
                                   Command="{Binding LoadHeaderFileCommand}"
                                   Appearance="Secondary"
                                   HorizontalAlignment="Stretch" />
                        
                        <ui:Button Grid.Column="4"
                                   Icon="{ui:SymbolIcon Delete24}"
                                   Command="{Binding ClearAllCommand}"
                                   ToolTip="Clear All"
                                   Appearance="Danger" />
                    </Grid>
                    
                    <!-- Watching Indicator -->
                    <Border Grid.Row="1" 
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="0,-8,-8,0"
                            Background="#4EC9B0"
                            CornerRadius="10"
                            Width="12" Height="12"
                            ToolTip="Watching for file changes"
                            Visibility="{Binding IsWatching, Converter={StaticResource BoolToVis}}" />

                    <!-- Stats Cards with Orange accent -->
                    <Grid Grid.Row="2" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <Border Grid.Column="0" Background="#252526" CornerRadius="8" Padding="12,10">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding HeaderFiles.Count}" 
                                           FontSize="22" 
                                           FontWeight="Bold" 
                                           Foreground="#FF8C00"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Files" FontSize="10" Foreground="#666666" HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="2" Background="#252526" CornerRadius="8" Padding="12,10">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding AllFunctions.Count}" 
                                           FontSize="22" 
                                           FontWeight="Bold" 
                                           Foreground="#FFA500"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Functions" FontSize="10" Foreground="#666666" HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                        
                        <Border Grid.Column="4" Background="#252526" CornerRadius="8" Padding="12,10">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="{Binding Fields.Count}" 
                                           FontSize="22" 
                                           FontWeight="Bold" 
                                           Foreground="#CE9178"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Fields" FontSize="10" Foreground="#666666" HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Border>

            <!-- Right Panel - Tabs -->
            <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="0">
                <TabControl x:Name="MainTabControl" 
                            Background="#151515" 
                            BorderThickness="0"
                            Style="{StaticResource DarkTabControlStyle}">
                    <TabControl.Resources>
                        <Style TargetType="TabItem" BasedOn="{StaticResource DarkTabItemStyle}" />
                    </TabControl.Resources>
                    
                    <!-- All Functions Tab (Main Tab) -->
                    <TabItem>
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="Code24" Margin="0,0,8,0" FontSize="16" Foreground="#FF8C00" />
                                <TextBlock Text="All Functions" VerticalAlignment="Center" />
                                <Border Background="#FF8C00" CornerRadius="10" Padding="8,3" Margin="10,0,0,0"
                                        Visibility="{Binding AllFunctions.Count, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="{Binding AllFunctions.Count}" FontSize="10" FontWeight="Bold" Foreground="White" />
                                </Border>
                            </StackPanel>
                        </TabItem.Header>
                        
                        <Grid Background="#1E1E1E">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            
                            <!-- Search Box -->
                            <Border Grid.Row="0" Background="#252526" Padding="16">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <ui:TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged, Delay=150}"
                                                PlaceholderText="Search functions by name, class, return type..."
                                                FontSize="14"
                                                Background="#1E1E1E"
                                                Foreground="White" />
                                    
                                    <Border Grid.Column="1" 
                                            Background="#FF8C00" 
                                            CornerRadius="6" 
                                            Padding="12,8"
                                            Margin="10,0,0,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding GlobalFilteredFunctions.Count}" 
                                                       FontWeight="Bold" 
                                                       Foreground="White" />
                                            <TextBlock Text=" / " Foreground="#FFDDAA" />
                                            <TextBlock Text="{Binding AllFunctions.Count}" Foreground="#FFDDAA" />
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                            
                            <!-- All Functions List with detailed info -->
                            <ListBox Grid.Row="1"
                                     ItemsSource="{Binding GlobalFilteredFunctions}"
                                     SelectedItem="{Binding SelectedFunction}"
                                     Style="{StaticResource DarkListBoxStyle}"
                                     Margin="8"
                                     ScrollViewer.VerticalScrollBarVisibility="Visible">
                                <ListBox.ItemTemplate>
                                    <DataTemplate DataType="{x:Type models:CppFunction}">
                                        <Border Style="{StaticResource ListItemStyle}">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                
                                                <!-- Orange accent bar -->
                                                <Border Grid.RowSpan="3" Background="#FF8C00" 
                                                        CornerRadius="4" 
                                                        Width="4" 
                                                        Margin="0,0,14,0" />
                                                
                                                <!-- Function Name Row -->
                                                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal">
                                                    <TextBlock Text="{Binding ClassName}"
                                                               FontSize="14"
                                                               Foreground="#4EC9B0"
                                                               FontWeight="Medium" />
                                                    <TextBlock Text="::"
                                                               FontSize="14"
                                                               Foreground="#666666" />
                                                    <TextBlock Text="{Binding FunctionName}"
                                                               FontWeight="Bold"
                                                               FontSize="14"
                                                               Foreground="#DCDCAA" />
                                                </StackPanel>
                                                
                                                <!-- Signature Row -->
                                                <TextBlock Grid.Row="1" Grid.Column="1"
                                                           Text="{Binding DisplayName}"
                                                           FontSize="11"
                                                           Foreground="#888888"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="0,4,0,0"
                                                           FontFamily="Cascadia Code, Consolas, Courier New" />
                                                
                                                <!-- Tags Row -->
                                                <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,6,0,0">
                                                    <!-- Return Type Tag -->
                                                    <Border Background="#333333" CornerRadius="4" Padding="6,2" Margin="0,0,6,0">
                                                        <TextBlock Text="{Binding ReturnType}"
                                                                   FontSize="10"
                                                                   Foreground="#569CD6"
                                                                   FontFamily="Cascadia Code, Consolas" />
                                                    </Border>
                                                    
                                                    <!-- Virtual Tag -->
                                                    <Border Background="#3D2C1E" CornerRadius="4" Padding="6,2" Margin="0,0,6,0"
                                                            Visibility="{Binding IsVirtual, Converter={StaticResource BoolToVis}}">
                                                        <TextBlock Text="virtual" FontSize="10" Foreground="#FF8C00" />
                                                    </Border>
                                                    
                                                    <!-- Static Tag -->
                                                    <Border Background="#2D3D2E" CornerRadius="4" Padding="6,2" Margin="0,0,6,0"
                                                            Visibility="{Binding IsStatic, Converter={StaticResource BoolToVis}}">
                                                        <TextBlock Text="static" FontSize="10" Foreground="#4EC9B0" />
                                                    </Border>
                                                    
                                                    <!-- Source File Tag -->
                                                    <Border Background="#2D2D2D" CornerRadius="4" Padding="6,2">
                                                        <StackPanel Orientation="Horizontal">
                                                            <ui:SymbolIcon Symbol="Document16" FontSize="10" Foreground="#666666" Margin="0,0,4,0" />
                                                            <TextBlock Text="{Binding SourceFile}"
                                                                       FontSize="10"
                                                                       Foreground="#666666"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       MaxWidth="120" />
                                                        </StackPanel>
                                                    </Border>
                                                </StackPanel>
                                                
                                                <!-- Generate Button -->
                                                <ui:Button Grid.Row="0" Grid.RowSpan="3" Grid.Column="2"
                                                           Content="Generate"
                                                           Icon="{ui:SymbolIcon Code24}"
                                                           Appearance="Primary"
                                                           Command="{Binding DataContext.GenerateHookWindowCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                           CommandParameter="{Binding}"
                                                           FontSize="11"
                                                           Padding="14,8"
                                                           VerticalAlignment="Center"
                                                           Margin="12,0,0,0" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <!-- Empty State -->
                            <StackPanel Grid.Row="1"
                                        VerticalAlignment="Center" 
                                        HorizontalAlignment="Center"
                                        Visibility="{Binding HasNoFunctionsLoaded, Converter={StaticResource BoolToVis}}">
                                <Border CornerRadius="50" Width="80" Height="80" Margin="0,0,0,20">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#2D2D2D" Offset="0"/>
                                            <GradientStop Color="#252526" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <ui:SymbolIcon Symbol="Code24" FontSize="36" Foreground="#FF8C00" 
                                                   VerticalAlignment="Center" HorizontalAlignment="Center" />
                                </Border>
                                <TextBlock Text="No functions loaded" 
                                           FontSize="16" FontWeight="Medium"
                                           Foreground="#888888" HorizontalAlignment="Center" />
                                <TextBlock Text="Load a header folder or file to see functions" 
                                           FontSize="12" Foreground="#555555" 
                                           Margin="0,6,0,0" HorizontalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                    </TabItem>
                    
                </TabControl>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="#151515"
                BorderBrush="#2D2D2D"
                BorderThickness="0,1,0,0"
                Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <ui:SymbolIcon Symbol="Info24" Foreground="#FF8C00" Margin="0,0,12,0" />
                    <TextBlock Text="{Binding StatusMessage}"
                               VerticalAlignment="Center"
                               Foreground="#AAAAAA"
                               FontSize="12" />
                </StackPanel>

                <!-- Progress Text -->
                <TextBlock Grid.Column="1" 
                           Text="{Binding ProgressText}"
                           Foreground="#FF8C00"
                           FontSize="11"
                           FontWeight="Medium"
                           VerticalAlignment="Center"
                           Margin="0,0,16,0"
                           Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" />

                <ui:ProgressRing Grid.Column="2"
                                 IsIndeterminate="True"
                                 Width="18"
                                 Height="18"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" />
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.Row="1" Grid.RowSpan="2"
                Background="#E6000000"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ui:ProgressRing IsIndeterminate="True" Width="60" Height="60" />
                <TextBlock Text="{Binding ProgressText}" 
                           Foreground="#FF8C00"
                           FontSize="16"
                           FontWeight="SemiBold"
                           Margin="0,24,0,0"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="#888888"
                           FontSize="12"
                           Margin="0,8,0,0"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>
    </Grid>
</ui:FluentWindow>

